!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e(t.TuaWx={})}(this,function(t){"use strict";var e=/^__.*__$/,d={enumerable:!0,configurable:!0},y="__TUA_PATH",v=function(t){return"function"==typeof t},b=function(t){return!e.test(t)},h=function(t,e){return""===t?e:t+"."+e},j=function(e,r){Object.keys(e).forEach(function(t){Object.defineProperty(r,t,Object.getOwnPropertyDescriptor(e,t))})},O=Array.prototype,m=["pop","push","sort","shift","splice","unshift","reverse"],P="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},g=null,D=null,w=function(d,b){return function(t){var e,r,n,o,a,c,i,u,f=t.path,l=t.newVal,p=t.oldVal,s=t.isArrDirty,y=void 0!==s&&s;g=_({},g,(n=l,(r=f)in(e={})?Object.defineProperty(e,r,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[r]=n,e)),y&&(c=(o={obj:d,val:l,path:f}).obj,i=o.path,u=o.val,(a=i,a.split(".").map(function(t){return t.split(/\[(.*?)\]/).filter(function(t){return t})}).reduce(function(t,e){return t.concat(e)},[])).reduce(function(t,e,r,n){if(r!==n.length-1)return t[e]||(t[e]=/\d/.test(e)?[]:{}),t[e];t[e]=u},c)),Promise.resolve().then(function(){if(g){d.setData(_({},d.$computed,g));var t=b[f];v(t)&&t.call(d,g[f],p),g=null}})}},A=function(t){var o=t.obj,a=t.key,c=t.val,i=t.observeDeep,u=t.asyncSetData;Object.defineProperty(o,a,_({},d,{get:function(){return c},set:function(t){if(t!==c){var e=c,r=o[y]||"",n=h(r,a);c=i(t,n),u({path:n,newVal:t,oldVal:e})}}}))},S=function(s){return function r(e){var t,n,o,a,i,u,f,c=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"";if(Array.isArray(e)){var l=e.map(function(t,e){return r(t,c+"["+e+"]")});return l[y]=c,D=D||(i=(a={observeDeep:r,asyncSetData:s}).observeDeep,u=a.asyncSetData,f=Object.create(O),m.forEach(function(a){var c=O[a];f[a]=function(){for(var t=this[y],e=arguments.length,r=Array(e),n=0;n<e;n++)r[n]=arguments[n];var o=c.apply(this,r);return u("pop"===a?{path:t,newVal:this}:{path:t,newVal:i(this,t),isArrDirty:!0}),o}}),f),n=(t={arr:l,arrayMethods:D}).arr,o=t.arrayMethods,Object.setPrototypeOf?Object.setPrototypeOf(n,o):"__proto__"in n?n.__proto__=o:j(o,n),n}if("object"===(void 0===e?"undefined":P(e))){var p=Object.create(null);return Object.defineProperty(p,y,{enumerable:!1,value:c}),Object.keys(e).filter(b).map(function(t){return{obj:p,key:t,val:r(e[t],h(c,t)),observeDeep:r,asyncSetData:s}}).forEach(A),p}return e}};console.log("[TUA-MP]: Version 0.5.2");t.TuaPage=function(t){var e=t.data,r=t.watch,p=void 0===r?{}:r,n=t.methods,o=void 0===n?{}:n,a=t.computed,s=void 0===a?{}:a,y=function(t,e){var r={};for(var n in t)0<=e.indexOf(n)||Object.prototype.hasOwnProperty.call(t,n)&&(r[n]=t[n]);return r}(t,["data","watch","methods","computed"]),c=v(e)?e():e;return Page(_({},y,o,{data:c,onLoad:function(){var t,e,o,a,c,i,r=w(this,p),n=S(r);e=n((t=this).data),t.$data=e,j(e,t),o=this,a=s,c=p,i=Object.create(null),Object.keys(a).forEach(function(r){var n=a[r].call(o);Object.defineProperty(i,r,_({},d,{get:function(){var t=a[r].call(o),e=c[r];return v(e)&&t!==n&&e.call(o,t,n),n=t},set:function(){console.warn("[TUA-MP]: 请勿对 computed 属性 "+r+" 赋值，它应该由 data 中的依赖自动计算得到！")}}))}),o.$computed=i,j(i,o),o.setData(i);for(var u=arguments.length,f=Array(u),l=0;l<u;l++)f[l]=arguments[l];y.onLoad&&y.onLoad.apply(this,f)}}))},Object.defineProperty(t,"__esModule",{value:!0})});
