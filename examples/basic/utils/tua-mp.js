!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e(t.TuaMp={})}(this,function(t){"use strict";var y="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},e=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},r=function(){function n(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(t,e,r){return e&&n(t.prototype,e),r&&n(t,r),t}}(),u=function(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t},v=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},h=function(t,e){var r={};for(var n in t)0<=e.indexOf(n)||Object.prototype.hasOwnProperty.call(t,n)&&(r[n]=t[n]);return r},b=function(t,e,r){var n,a,o;this.triggerEvent(t,(a=(n=e).detail,o=n.currentTarget,v({},a,o.dataset)),r)},n=/^__.*__$/,a=[String,Number,Boolean,Object,Array,null],f={enumerable:!0,configurable:!0},c=Object.prototype.toString,m="__TUA_PATH__",j="__dep__",l=function(t){return console.warn("[TUA-MP warn]: "+t)},O=function(t){return"function"==typeof t},w=function(t){return!n.test(t)},g=function(t,e){return""===t?e:t+"."+e},_=function(e,r){Object.keys(e).forEach(function(t){Object.defineProperty(r,t,Object.getOwnPropertyDescriptor(e,t))})},s=function(t,e){var r,n,a,o=void 0,i=(n=(r=e)&&r.toString().match(/^\s*function (\w+)/))?n[1]:"";if(/(String|Number|Boolean)/.test(i)){var u=void 0===t?"undefined":y(t);(o=u===i.toLowerCase())||"object"!==u||(o=t instanceof e)}else"Object"===i?(a=t,o="[object Object]"===c.call(a)):o="Array"===i?Array.isArray(t):t instanceof e;return{valid:o,expectedType:i}},i=function(t){var e=t.prop,r=t.name,a=t.value;if(null==a)return!0;var n,o=[],i=e.type,u=!i;i&&(Array.isArray(i)?i:[i]).forEach(function(t){var e=s(a,t),r=e.valid,n=e.expectedType;o.push(n),u=r});return u||l('Invalid prop: type check failed for prop "'+r+'". Expected '+o.join(", ")+", got "+(n=a,c.call(n).slice(8,-1))+"."),u},S=function(r){var n=function(t){var o,e=t.name,r=t.type,n=t.value,a=t.propObj;return u({},e,{type:r,value:n,observer:(o=e,function(a){return function(t){var e=this;Promise.resolve().then(function(){e[o]=t});var r=i({prop:a,name:o,value:t}),n=a.validator;return n&&!n(t)?(l('Invalid prop: custom validator check failed for prop "'+o+'".'),!1):r}})(a)})};return Array.isArray(r)?r.map(function(t){return n({name:t,type:null,propObj:{type:null}})}).reduce(function(t,e){return v({},t,e)},{}):Object.keys(r).map(function(t){var e=r[t];return-1!==a.indexOf(e)?n({name:t,type:e,propObj:{type:e}}):Array.isArray(e)?n({name:t,type:null,propObj:{type:e}}):n({name:t,type:e.type||null,value:O(e.default)?e.default():e.default,propObj:e})}).reduce(function(t,e){return v({},t,e)},{})},p=function(t){var e=t.__wxWebviewId__,r=t.__wxExparserNodeId__;return e+"_"+(void 0===r?"wxExparserNodeId":r)},d=new(function(){function t(){e(this,t),this.VM_MAP=Object.create(null),this.newStateByVM=Object.create(null),this.oldStateByVM=Object.create(null)}return r(t,[{key:"updateState",value:function(t){var e=t.vm,r=t.watch,n=t.path,a=t.newVal,o=t.oldVal,i=p(e);this.newStateByVM=v({},this.newStateByVM,u({},i,v({},this.newStateByVM[i],u({},n,a)))),this.oldStateByVM=v({},this.oldStateByVM,u({},i,v(u({},n,o),this.oldStateByVM[i]))),this.VM_MAP[i]||(this.VM_MAP[i]={vm:e,watch:r})}},{key:"flushState",value:function(){var r=this;Object.keys(this.newStateByVM).filter(function(t){return r.VM_MAP[t]}).forEach(function(t){var e=r.VM_MAP[t],a=e.vm,o=e.watch,i=r.newStateByVM[t],u=r.oldStateByVM[t];a.setData(i),Object.keys(i).filter(function(t){return O(o[t])}).forEach(function(t){var e=o[t],r=i[t],n=u[t];e.call(a,r,n)})}),this.newStateByVM=Object.create(null),this.oldStateByVM=Object.create(null)}},{key:"deleteVm",value:function(t){var e=p(t);delete this.VM_MAP[e]}}]),t}()),V=function(s,p){return function(t){var e,r,n,a,o,i=t.path,u=t.newVal,c=t.oldVal,l=t.isArrDirty,f=void 0!==l&&l;d.updateState({vm:s,watch:p,path:i,newVal:u,oldVal:c}),f&&(n=(e={obj:s,val:u,path:i}).obj,a=e.path,o=e.val,(r=a,r.split(".").map(function(t){return t.split(/\[(.*?)\]/).filter(function(t){return t})}).reduce(function(t,e){return t.concat(e)},[])).reduce(function(t,e,r,n){if(r!==n.length-1)return t[e]||(t[e]=/\d/.test(e)?[]:{}),t[e];t[e]=o},n)),Promise.resolve().then(d.flushState.bind(d))}},A=d.deleteVm.bind(d),M=Array.prototype,P=["pop","push","sort","shift","splice","unshift","reverse"],k=function(){function t(){e(this,t),this.subs=[]}return r(t,[{key:"addSub",value:function(t){-1<this.subs.indexOf(t)||this.subs.push(t)}},{key:"notify",value:function(){this.subs.forEach(function(t){return t()})}}]),t}();k.targetCb=null;var B=function(t){var a=t.obj,o=t.key,i=t.val,u=t.observeDeep,c=t.asyncSetData,l=a[j]||new k;Object.defineProperty(a,j,{value:l,enumerable:!1,configurable:!0}),Object.defineProperty(a,o,v({},f,{get:function(){return k.targetCb&&(l.addSub(k.targetCb),Array.isArray(i)&&(i.forEach(function(t){t[j]&&t[j].addSub(k.targetCb)}),i[j]=l)),i},set:function(t){if(t!==i){var e=i,r=a[m]||"",n=g(r,o);(i=u(t,n))&&e&&!i[j]&&e[j]&&"object"===(void 0===i?"undefined":y(i))&&(i[j]=e[j]),c({path:n,newVal:t,oldVal:e}),l.notify()}}}))},x=function(d){return function r(n){var t,e,a,o,c,l,f,i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"";if(Array.isArray(n)){var u=n.map(function(t,e){return!t[j]&&n[j]&&(t[j]=n[j]),r(t,i+"["+e+"]")});u[m]=i;var s=(c=(o={observeDeep:r,asyncSetData:d}).observeDeep,l=o.asyncSetData,f=Object.create(M),P.forEach(function(i){var u=M[i];f[i]=function(){for(var t=this[m],e=arguments.length,r=Array(e),n=0;n<e;n++)r[n]=arguments[n];var a=u.apply(this,r);if("pop"===i)l({path:t,newVal:this});else{var o=c(this,t);Object.assign(this,o),l({path:t,newVal:o,isArrDirty:!0})}return a}}),f);return e=(t={arr:u,arrayMethods:s}).arr,a=t.arrayMethods,Object.setPrototypeOf?Object.setPrototypeOf(e,a):"__proto__"in e?e.__proto__=a:_(a,e),e}if(null!==n&&"object"===(void 0===n?"undefined":y(n))){var p=Object.create(null);return n[j]&&Object.defineProperty(p,j,{value:n[j],enumerable:!1,configurable:!0}),Object.defineProperty(p,m,{enumerable:!1,value:i}),Object.keys(n).filter(w).map(function(t){return{obj:p,key:t,val:r(n[t],g(i,t)),observeDeep:r,asyncSetData:d}}).forEach(B),p}return n}},E=function(t,e){var r=e(t.data);t.$data=r,_(r,t)},C=function(o,i,u){var c=Object.create(null);Object.keys(i).forEach(function(e){var r=new k,n=i[e].bind(o),a=n(),t=!0;Object.defineProperty(c,e,v({},f,{get:function(){return k.targetCb&&r.addSub(k.targetCb),t?(k.targetCb=function(){var t=n();u({path:e,newVal:t,oldVal:a}),r.notify()},k.targetCb.key=e,a=n(),k.targetCb=null,t=!1,a):a=n()},set:function(){l("请勿对 computed 属性 "+e+" 赋值，它应该由 data 中的依赖自动计算得到！")}}))}),o.$computed=c,_(c,o),o.setData(c)};console.log("[TUA-MP]: Version 0.6.3");t.TuaComp=function(t){var e=t.data,r=void 0===e?{}:e,n=t.props,a=void 0===n?{}:n,o=t.watch,i=void 0===o?{}:o,u=t.methods,c=void 0===u?{}:u,l=t.computed,f=void 0===l?{}:l,s=t.properties,p=void 0===s?{}:s,d=h(t,["data","props","watch","methods","computed","properties"]),y=O(r)?r():r;return Component(v({},d,{data:y,methods:v({},c,{$emit:b}),properties:v({},p,S(a)),attached:function(){var t=V(this,i),e=x(t);E(this,e),C(this,f,t);for(var r=arguments.length,n=Array(r),a=0;a<r;a++)n[a]=arguments[a];d.attached&&d.attached.apply(this,n)},detached:function(){A(this);for(var t=arguments.length,e=Array(t),r=0;r<t;r++)e[r]=arguments[r];d.detached&&d.detached.apply(this,e)}}))},t.TuaPage=function(t){var e=t.data,r=void 0===e?{}:e,n=t.watch,o=void 0===n?{}:n,a=t.methods,i=void 0===a?{}:a,u=t.computed,c=void 0===u?{}:u,l=h(t,["data","watch","methods","computed"]),f=O(r)?r():r;return Page(v({},l,i,{data:f,onLoad:function(){var t=V(this,o),e=x(t);E(this,e),C(this,c,t);for(var r=arguments.length,n=Array(r),a=0;a<r;a++)n[a]=arguments[a];l.onLoad&&l.onLoad.apply(this,n)},onUnload:function(){A(this);for(var t=arguments.length,e=Array(t),r=0;r<t;r++)e[r]=arguments[r];l.onUnload&&l.onUnload.apply(this,e)}}))},Object.defineProperty(t,"__esModule",{value:!0})});
