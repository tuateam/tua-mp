!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(e.TuaMp={})}(this,function(e){"use strict";var t=/^__.*__$/,b=[String,Number,Boolean,Object,Array,null],l={enumerable:!0,configurable:!0},c=Object.prototype.toString,d="__TUA_PATH__",y="__dep__",v="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},n=function(){function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e}}(),h=function(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e},m=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},j=function(e,t){var r={};for(var n in e)0<=t.indexOf(n)||Object.prototype.hasOwnProperty.call(e,n)&&(r[n]=e[n]);return r},g=function(e){return console.warn("[TUA-MP warn]: "+e)},O=function(e){return"function"==typeof e},_=function(e){return!t.test(e)},w=function(e,t){return""===e?t:e+"."+t},A=function(t,r){Object.keys(t).forEach(function(e){Object.defineProperty(r,e,Object.getOwnPropertyDescriptor(t,e))})},f=function(e,t){var r,n,o,a=void 0,i=(n=(r=t)&&r.toString().match(/^\s*function (\w+)/))?n[1]:"";if(/(String|Number|Boolean)/.test(i)){var u=void 0===e?"undefined":v(e);(a=u===i.toLowerCase())||"object"!==u||(a=e instanceof t)}else"Object"===i?(o=e,a="[object Object]"===c.call(o)):a="Array"===i?Array.isArray(e):e instanceof t;return{valid:a,expectedType:i}},P=function(e){var t=e.prop,r=e.name,o=e.value;if(null==o)return!0;var n,a=[],i=t.type,u=!i;i&&(Array.isArray(i)?i:[i]).forEach(function(e){var t=f(o,e),r=t.valid,n=t.expectedType;a.push(n),u=r});return u||g('Invalid prop: type check failed for prop "'+r+'". Expected '+a.join(", ")+", got "+(n=o,c.call(n).slice(8,-1))+"."),u},S={},k={},x={},C=function(e){var t=e.__wxWebviewId__,r=e.__wxExparserNodeId__;return t+"_"+(void 0===r?"wxExparserNodeId":r)},D=function(s,d){return function(e){var t,r,n,o,a,i=e.path,u=e.newVal,c=e.oldVal,f=e.isArrDirty,l=void 0!==f&&f,p=C(s);S=m({},S,h({},p,m({},S[p],h({},i,u)))),k=m({},k,h({},p,m(h({},i,c),k[p]))),x[p]||(x[p]={vm:s,watch:d}),l&&(n=(t={obj:s,val:u,path:i}).obj,o=t.path,a=t.val,(r=o,r.split(".").map(function(e){return e.split(/\[(.*?)\]/).filter(function(e){return e})}).reduce(function(e,t){return e.concat(t)},[])).reduce(function(e,t,r,n){if(r!==n.length-1)return e[t]||(e[t]=/\d/.test(t)?[]:{}),e[t];e[t]=a},n)),Promise.resolve().then(function(){var e=Object.keys(S);e.length&&(e.forEach(function(e){var t=x[e],o=t.vm,a=t.watch,i=S[e],u=k[e];o.setData(i),Object.keys(i).filter(function(e){return O(a[e])}).forEach(function(e){var t=a[e],r=i[e],n=u[e];t.call(o,r,n)})}),S={},k={})})}},E=function(e){var t=C(e);delete x[t]},T=Array.prototype,V=["pop","push","sort","shift","splice","unshift","reverse"],p=function(){function e(){r(this,e),this.subs=[]}return n(e,[{key:"addSub",value:function(e){-1<this.subs.indexOf(e)||this.subs.push(e)}},{key:"notify",value:function(){this.subs.forEach(function(e){return e()})}}]),e}(),M=p.targetCb=null,U=function(e){var o=e.obj,a=e.key,i=e.val,u=e.observeDeep,c=e.asyncSetData,f=o[y]||new p;Object.defineProperty(o,y,{value:f,enumerable:!1,configurable:!0}),Object.defineProperty(o,a,m({},l,{get:function(){return p.targetCb&&(f.addSub(p.targetCb),Array.isArray(i)&&(i.forEach(function(e){e[y]&&e[y].addSub(p.targetCb)}),i[y]=f)),i},set:function(e){if(e!==i){var t=i,r=o[d]||"",n=w(r,a);(i=u(e,n))&&t&&!i[y]&&t[y]&&(i[y]=t[y]),c({path:n,newVal:e,oldVal:t}),f.notify()}}}))},I=function(s){return function r(n){var e,t,o,a,c,f,l,i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"";if(Array.isArray(n)){var u=n.map(function(e,t){return!e[y]&&n[y]&&(e[y]=n[y]),r(e,i+"["+t+"]")});return u[d]=i,M=M||(c=(a={observeDeep:r,asyncSetData:s}).observeDeep,f=a.asyncSetData,l=Object.create(T),V.forEach(function(i){var u=T[i];l[i]=function(){for(var e=this[d],t=arguments.length,r=Array(t),n=0;n<t;n++)r[n]=arguments[n];var o=u.apply(this,r);if("pop"===i)f({path:e,newVal:this});else{var a=c(this,e);Object.assign(this,a),f({path:e,newVal:a,isArrDirty:!0})}return o}}),l),t=(e={arr:u,arrayMethods:M}).arr,o=e.arrayMethods,Object.setPrototypeOf?Object.setPrototypeOf(t,o):"__proto__"in t?t.__proto__=o:A(o,t),t}if(null!==n&&"object"===(void 0===n?"undefined":v(n))){var p=Object.create(null);return n[y]&&Object.defineProperty(p,y,{value:n[y],enumerable:!1,configurable:!0}),Object.defineProperty(p,d,{enumerable:!1,value:i}),Object.keys(n).filter(_).map(function(e){return{obj:p,key:e,val:r(n[e],w(i,e)),observeDeep:r,asyncSetData:s}}).forEach(U),p}return n}},L=function(e,t){var r=t(e.data);e.$data=r,A(r,e)},N=function(a,i,u){var c=Object.create(null);Object.keys(i).forEach(function(e){var t=new p,r=i[e].bind(a),n=r(),o=!0;Object.defineProperty(c,e,m({},l,{get:function(){return p.targetCb&&t.addSub(p.targetCb),o?(p.targetCb=function(){u({path:e,newVal:r(),oldVal:n}),t.notify()},p.targetCb.key=e,n=r(),p.targetCb=null,o=!1,n):n=r()},set:function(){g("请勿对 computed 属性 "+e+" 赋值，它应该由 data 中的依赖自动计算得到！")}}))}),a.$computed=c,A(c,a),a.setData(c)};console.log("[TUA-MP]: Version 0.6.0");e.TuaComp=function(e){var a,t=e.data,r=void 0===t?{}:t,n=e.props,o=void 0===n?{}:n,i=e.watch,u=void 0===i?{}:i,c=e.methods,f=void 0===c?{}:c,l=e.computed,p=void 0===l?{}:l,s=e.properties,d=void 0===s?{}:s,y=j(e,["data","props","watch","methods","computed","properties"]),v=O(r)?r():r;return Component(m({},y,{data:v,methods:f,properties:m({},d,(a=o,Array.isArray(a)?a.map(function(e){return h({},e,null)}).reduce(function(e,t){return m({},e,t)},{}):Object.keys(a).map(function(o){var e=a[o];if(-1!==b.indexOf(e))return h({},o,e);var t=function(n){return function(e){var t=P({prop:n,name:o,value:e}),r=n.validator;return r&&!r(e)?(g('Invalid prop: custom validator check failed for prop "'+o+'".'),!1):t}};if(Array.isArray(e)){var r={type:null,observer:t({type:e})};return h({},o,r)}var n={type:e.type||null,value:O(e.default)?e.default():e.default,observer:t(e)};return h({},o,n)}).reduce(function(e,t){return m({},e,t)},{}))),attached:function(){var e=D(this,u),t=I(e);L(this,t),N(this,p,e);for(var r=arguments.length,n=Array(r),o=0;o<r;o++)n[o]=arguments[o];y.attached&&y.attached.apply(this,n)},detached:function(){E(this);for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];y.detached&&y.detached.apply(this,t)}}))},e.TuaPage=function(e){var t=e.data,r=void 0===t?{}:t,n=e.watch,a=void 0===n?{}:n,o=e.methods,i=void 0===o?{}:o,u=e.computed,c=void 0===u?{}:u,f=j(e,["data","watch","methods","computed"]),l=O(r)?r():r;return Page(m({},f,i,{data:l,onLoad:function(){var e=D(this,a),t=I(e);L(this,t),N(this,c,e);for(var r=arguments.length,n=Array(r),o=0;o<r;o++)n[o]=arguments[o];f.onLoad&&f.onLoad.apply(this,n)},onUnload:function(){E(this);for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];f.onUnload&&f.onUnload.apply(this,t)}}))},Object.defineProperty(e,"__esModule",{value:!0})});
